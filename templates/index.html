<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ABIF ‚Äì D√©tection de Plagiat üöÄ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    * {margin:0; padding:0; box-sizing:border-box;}
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(-45deg, #74ebd5, #acb6e5, #00b4db, #0083b0);
      background-size: 400% 400%;
      animation: gradientMove 10s ease infinite;
      color: #fff;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    @keyframes gradientMove {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    .app {
      width: 90%;
      max-width: 950px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 25px;
      backdrop-filter: blur(15px);
      padding: 40px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      text-align: center;
      position: relative;
      overflow: hidden;
      animation: zoomIn 1.2s ease;
    }
    @keyframes zoomIn {
      from {transform: scale(0.8); opacity: 0;}
      to {transform: scale(1); opacity: 1;}
    }
    h1 {
      font-size: 2.8rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #ffcc00, #ff0066);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 2px;
    }
    .subtitle {opacity: 0.9; margin-bottom: 25px; font-size: 1.1rem;}
    .nav-buttons {display: flex; justify-content: center; gap: 15px; margin-bottom: 35px;}
    .btn {
      padding: 12px 30px;
      border-radius: 50px;
      border: none;
      background: linear-gradient(45deg, #00b4db, #0083b0);
      color: #fff; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .btn:hover {transform: scale(1.08); background: linear-gradient(45deg, #f9d423, #ff4e50);}
    section {display: none; animation: fadeIn 0.8s ease;}
    section.active {display: block;}
    @keyframes fadeIn {from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);}}
    .blacklist-form input {padding: 10px; border-radius: 10px; border: none; width: 60%; outline: none; margin-right: 10px;}
    .blacklist-form button {
      padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer;
      background: #ff4e50; color: white; font-weight: bold; transition: 0.3s;
    }
    .blacklist-form button:hover {background: #f9d423; color: #333;}
    ul.blacklist {list-style: none; margin-top: 20px;}
    ul.blacklist li {background: rgba(255,255,255,0.2); margin: 5px 0; padding: 10px; border-radius: 10px; transition: 0.3s;}
    ul.blacklist li:hover {background: rgba(255,255,255,0.4);}
    input, textarea {
      width: 90%; border-radius: 10px; border: none; padding: 10px;
      resize: none; outline: none; margin-bottom: 15px;
      background: rgba(255,255,255,0.2); color: #fff; font-size: 1rem;
    }
    .compare-btn {
      background: linear-gradient(45deg, #56ab2f, #a8e063);
      color: #fff; padding: 12px 35px; border: none; border-radius: 50px;
      font-weight: bold; font-size: 1.1rem; cursor: pointer; transition: 0.3s;
    }
    .compare-btn:hover {transform: scale(1.05);}
    .progress {
      background: rgba(255,255,255,0.3); border-radius: 30px; height: 25px; margin-top: 15px; overflow: hidden;
    }
    .progress-bar {
      height: 25px; width: 0%; border-radius: 30px;
      background: linear-gradient(90deg, #f9d423, #ff4e50);
      text-align: center; color: #fff; font-weight: bold; transition: width 1s ease;
    }
    .result {margin-top: 20px; font-size: 1.3rem;}
    #flash {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255, 0, 0, 0.6); z-index: 999; display: none; animation: flashAnim 0.3s infinite alternate;
    }
    @keyframes flashAnim {from {opacity: 0.3;} to {opacity: 1;}}
  </style>
</head>
<body>
  <div id="flash"></div>

  <div class="app">
    <h1>üî• ABIF</h1>
    <p class="subtitle">D√©tection de plagiat avec style et intelligence ‚ú®</p>

    <div class="nav-buttons">
      <button class="btn" onclick="showSection('home')">üè† Accueil</button>
      <button class="btn" onclick="showSection('blacklist')">üö´ Blacklist</button>
      <button class="btn" onclick="showSection('compare')">üîç Comparer</button>
    </div>

    <section id="home" class="active">
      <h2>Bienvenue sur ABIF üëã</h2>
      <p>Comparez des textes, d√©tectez le plagiat et gardez la classe üòé</p>
    </section>

    <section id="blacklist">
      <h2>Liste Noire üö´</h2>
      <form class="blacklist-form" onsubmit="addToBlacklist(event)">
        <input type="text" id="nom" placeholder="Nom de l'√©tudiant..." required>
        <button type="submit">Ajouter</button>
      </form>
      <ul id="blacklist-list" class="blacklist"></ul>
    </section>

    <section id="compare">
      <h2>Comparer deux textes üîç</h2>
      <input type="text" id="nomEtudiant1" placeholder="Nom de l'√©tudiant 1..." required>
      <input type="text" id="nomEtudiant2" placeholder="Nom de l'√©tudiant 2..." required>
      <textarea id="text1" placeholder="Texte de l'√©tudiant 1..."></textarea>
      <textarea id="text2" placeholder="Texte de l'√©tudiant 2..."></textarea>
      <button class="compare-btn" onclick="compareTexts()">Comparer</button>

      <div class="progress">
        <div class="progress-bar" id="progress-bar">0%</div>
      </div>
      <div class="result" id="result">‚è≥ En attente...</div>
    </section>
  </div>

  <script>
    function showSection(id) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    const blacklist = [];
    function addToBlacklist(event) {
      event.preventDefault();
      const nom = document.getElementById('nom').value.trim();
      if (nom) {
        if (!blacklist.includes(nom)) {
          blacklist.push(nom);
          updateBlacklist();
        }
        document.getElementById('nom').value = '';
      }
    }

    function updateBlacklist() {
      document.getElementById('blacklist-list').innerHTML = blacklist.map(n => `<li>${n}</li>`).join('');
    }

    // --- Comparaison ---
    function compareTexts() {
      const text1 = document.getElementById('text1').value.trim();
      const text2 = document.getElementById('text2').value.trim();
      const nom1 = document.getElementById('nomEtudiant1').value.trim();
      const nom2 = document.getElementById('nomEtudiant2').value.trim();

      if (!text1 || !text2 || !nom1 || !nom2) {
        alert("Veuillez remplir tous les champs !");
        return;
      }

      const result = document.getElementById('result');
      const progressBar = document.getElementById('progress-bar');
      const flash = document.getElementById('flash');

      let percent = 0;
      const interval = setInterval(() => {
        percent += 10;
        progressBar.style.width = percent + '%';
        progressBar.textContent = percent + '%';
        if (percent >= 100) {
          clearInterval(interval);

          const similarity = calculateSimilarity(text1, text2);
          progressBar.textContent = Math.round(similarity) + '%';

          if (similarity > 80) {
            flash.style.display = 'block';
            result.innerHTML = `üö® <strong>${nom1}</strong> & <strong>${nom2}</strong> ‚Äî ${Math.round(similarity)}% de similarit√©<br>‚ö†Ô∏è Plagiat d√©tect√© !`;
            setTimeout(() => flash.style.display = 'none', 2000);

            // Ajout auto √† la blacklist
            [nom1, nom2].forEach(nom => {
              if (!blacklist.includes(nom)) {
                blacklist.push(nom);
              }
            });
            updateBlacklist();

            // Envoi vers base de donn√©es
            fetch('/add_blacklist', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({etudiant1: nom1, etudiant2: nom2, similarite: similarity})
            });

          } else {
            result.innerHTML = `üéâ <strong>${nom1}</strong> & <strong>${nom2}</strong> ‚Äî ${Math.round(similarity)}% de similarit√©<br>Textes originaux ‚úÖ`;
            launchConfetti();
          }
        }
      }, 150);
    }

    function calculateSimilarity(a, b) {
      if (!a || !b) return 0;
      const wordsA = a.split(/\s+/);
      const wordsB = b.split(/\s+/);
      const common = wordsA.filter(word => wordsB.includes(word));
      return (common.length / Math.max(wordsA.length, wordsB.length)) * 100;
    }

    function launchConfetti() {
      const count = 80;
      for (let i = 0; i < count; i++) {
        const conf = document.createElement('div');
        conf.style.position = 'fixed';
        conf.style.top = Math.random() * window.innerHeight + 'px';
        conf.style.left = Math.random() * window.innerWidth + 'px';
        conf.style.width = '8px';
        conf.style.height = '8px';
        conf.style.borderRadius = '50%';
        conf.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
        conf.style.opacity = '0.8';
        conf.style.animation = `fall ${1 + Math.random() * 2}s linear forwards`;
        document.body.appendChild(conf);
        setTimeout(() => conf.remove(), 2000);
      }
    }

    const style = document.createElement('style');
    style.innerHTML = `@keyframes fall {to {transform: translateY(100vh) rotate(720deg); opacity: 0;}}`;
    document.head.appendChild(style);
  </script>
</body>
</html>
